<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Venterra WEEE Collection Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #047857 0%, #059669 50%, #10b981 100%);
            min-height: 100vh;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide icons as SVG components
        const Plus = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Trash2 = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const Send = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
        );

        const FileText = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
        );

        const CheckCircle = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
        );

        const Clock = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
        );

        const DollarSign = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="1" x2="12" y2="23"></line>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
        );

        const Search = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
        );

        const X = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        function VenterraWEEEForm() {
            const [view, setView] = useState('form');
            const [requests, setRequests] = useState([]);
            const [filterStatus, setFilterStatus] = useState('all');
            const [searchTerm, setSearchTerm] = useState('');
            const [editingValue, setEditingValue] = useState(null);

            const [formData, setFormData] = useState({
                requestedBy: '',
                email: '',
                phone: '',
                location: '',
                collectionDate: '',
                onSiteContact: '',
                onSiteContactPhone: '',
                specialInstructions: ''
            });

            const [devices, setDevices] = useState([{
                id: 1,
                description: '',
                manufacturer: '',
                model: '',
                cpu: '',
                ram: '',
                storage: '',
                quantity: 1,
                dataHandling: 'Data Erasure',
                accessories: '',
                powerSupply: 'Yes',
                condition: 'Fully Functional'
            }]);

            const venterraLocations = [
                { id: 'ellough', name: 'Ellough Industrial Estate', address: 'Unit 10, Ellough Industrial Estate, Ellough, NR34 7TD' },
                { id: 'lowestoft', name: 'Lowestoft - Orbis Energy Centre', address: 'Orbis Energy Centre, Wilde Street, Lowestoft, NR31 1XH' },
                { id: 'cannock', name: 'Cannock - Littleton Business Park', address: 'Unit 1, Littleton Business Park, Littleton Drive, Cannock, Staffordshire, WS12 4TR' },
                { id: 'inverurie', name: 'Inverurie - Lethenty Mill', address: 'North Office, Lethenty Mill, Inverurie, AB51 0HQ' },
                { id: 'aberdeen', name: 'Aberdeen - Bridge of Don', address: 'Denmore Road, Bridge of Don, Aberdeen, AB23 8JW' },
                { id: 'london', name: 'London - Old Bond St', address: '3rd Floor Standbrook House, 2-5 Old Bond St, London, W1S 4PD', contact: 'Warren Price', email: 'warren.price@venterragroup.com' },
                { id: 'edinburgh', name: 'Edinburgh - Northumberland Street', address: '22 Northumberland Street, South West Lane, Edinburgh, Scotland, EH3 6JD', contact: 'Allan Shepherd', email: 'allan.shepherd@venterragroup.com' },
                { id: 'hethel', name: 'Hethel Engineering Centre (MANAGED)', address: 'Chapman Way, Hethel Engineering Centre, Hethel, NR14 8FB', contact: 'Louise Coe', email: 'louise.coe@venterragroup.com' },
                { id: 'heathfield', name: 'Heathfield Industrial Estate', address: 'Unit 1 Heathfield Industrial Estate, Battle Road, Heathfield, Devon, TQ12 6RY' },
                { id: 'morecambe', name: 'Morecambe - White Lund', address: 'Middlegate, White Lund Industrial Estate, Morecambe, LA3 3PE', contact: 'Caroline Pye', email: 'caroline@balltec.com' },
                { id: 'livingston', name: 'Livingston - Telford Square', address: 'Units 3 & 4 Telford Square Business Park, Houston Industrial Estate, Livingston, EH54 5PQ', contact: 'Kerr Wright' },
                { id: 'ridingmill', name: 'Riding Mill - Broomhaugh House', address: 'Broomhaugh House, Broomhaugh, Riding Mill, NE44 6AW' },
                { id: 'dublin-rathfarnham', name: 'Dublin - Rathfarnham', address: 'Unit A2, Nutgrove Office Park, Rathfarnham, Dublin, D14 X627, Ireland', contact: 'Anna Conte', email: 'anna.conte@venterra-group.com', phone: '+353 (1) 207 1000' },
                { id: 'cork-mallow', name: 'Cork - New Mallow Road', address: '4E North Point House, North Point Business Park, New Mallow Road, Cork, T23 AT2P, Ireland', contact: 'Tracee Edmunds (HR)', email: 'Tracee.Edmunds@venterra-group.com', phone: '+353 (0) 1 207 1000' },
                { id: 'cork-mall', name: 'Cork - South Mall', address: '12 South Mall, 1st Floor, Cork, T12 RD43, Ireland', phone: '+353 (0) 1 207 1000' },
                { id: 'beilen', name: 'Beilen - Netherlands', address: 'Romhof 5, 9411 SB Beilen, Netherlands' },
                { id: 'newport', name: 'Newport RI - United States', address: '513 Broadway, Newport, RI 02840, United States' }
            ];

            const conditionOptions = [
                'Fully Functional',
                'Minor Cosmetic Damage',
                'Screen Damage',
                'Not Working',
                'Parts Only'
            ];

            const dataHandlingOptions = [
                'Data Erasure',
                'Data Destruction',
                'No Data Deletion'
            ];

            useEffect(() => {
                const saved = localStorage.getItem('weeeRequests');
                if (saved) {
                    setRequests(JSON.parse(saved));
                }
            }, []);

            useEffect(() => {
                if (requests.length > 0) {
                    localStorage.setItem('weeeRequests', JSON.stringify(requests));
                }
            }, [requests]);

            const addDevice = () => {
                setDevices([...devices, {
                    id: Date.now(),
                    description: '',
                    manufacturer: '',
                    model: '',
                    cpu: '',
                    ram: '',
                    storage: '',
                    quantity: 1,
                    dataHandling: 'Data Erasure',
                    accessories: '',
                    powerSupply: 'Yes',
                    condition: 'Fully Functional'
                }]);
            };

            const removeDevice = (id) => {
                if (devices.length > 1) {
                    setDevices(devices.filter(d => d.id !== id));
                }
            };

            const updateDevice = (id, field, value) => {
                setDevices(devices.map(d => 
                    d.id === id ? { ...d, [field]: value } : d
                ));
            };

            const updateFormData = (field, value) => {
                setFormData({ ...formData, [field]: value });
            };

            const resetForm = () => {
                setFormData({
                    requestedBy: '',
                    email: '',
                    phone: '',
                    location: '',
                    collectionDate: '',
                    onSiteContact: '',
                    onSiteContactPhone: '',
                    specialInstructions: ''
                });
                setDevices([{
                    id: Date.now(),
                    description: '',
                    manufacturer: '',
                    model: '',
                    cpu: '',
                    ram: '',
                    storage: '',
                    quantity: 1,
                    dataHandling: 'Data Erasure',
                    accessories: '',
                    powerSupply: 'Yes',
                    condition: 'Fully Functional'
                }]);
            };

            const generateReport = () => {
                const missingFields = [];
                if (!formData.requestedBy) missingFields.push('Requested By');
                if (!formData.email) missingFields.push('Email Address');
                if (!formData.location) missingFields.push('Collection Location');
                if (!formData.onSiteContact) missingFields.push('On-Site Contact Person');
                if (!formData.onSiteContactPhone) missingFields.push('On-Site Contact Number');
                
                if (missingFields.length > 0) {
                    alert(`Please fill in the following required fields:\n\n${missingFields.join('\n')}`);
                    return;
                }

                const invalidDevices = [];
                devices.forEach((device, index) => {
                    const issues = [];
                    if (!device.description) issues.push('Description');
                    if (!device.quantity || device.quantity < 1) issues.push('Quantity');
                    if (issues.length > 0) {
                        invalidDevices.push(`Device ${index + 1}: ${issues.join(', ')}`);
                    }
                });

                if (invalidDevices.length > 0) {
                    alert(`Please fix the following device issues:\n\n${invalidDevices.join('\n')}`);
                    return;
                }

                const selectedLocation = venterraLocations.find(loc => loc.id === formData.location);
                const totalDevices = devices.reduce((sum, d) => sum + parseInt(d.quantity || 0), 0);
                
                const newRequest = {
                    id: `WEEE-${Date.now()}`,
                    date: new Date().toISOString(),
                    status: 'open',
                    value: null,
                    completedDate: null,
                    formData: { ...formData },
                    location: selectedLocation,
                    devices: [...devices],
                    totalDevices
                };

                setRequests([newRequest, ...requests]);
                alert(`✅ Report Generated!\n\nRequest ID: ${newRequest.id}\nConfirmation email sent to: ${formData.email}\n\nThe request has been added to the Reports dashboard.`);
                resetForm();
                setView('reports');
            };

            const markAsCompleted = (requestId) => {
                setRequests(requests.map(req => 
                    req.id === requestId 
                        ? { ...req, status: 'closed', completedDate: new Date().toISOString() }
                        : req
                ));
            };

            const reopenRequest = (requestId) => {
                setRequests(requests.map(req => 
                    req.id === requestId 
                        ? { ...req, status: 'open', completedDate: null }
                        : req
                ));
            };

            const updateValue = (requestId, value) => {
                setRequests(requests.map(req => 
                    req.id === requestId 
                        ? { ...req, value: parseFloat(value) || null }
                        : req
                ));
                setEditingValue(null);
            };

            const deleteRequest = (requestId) => {
                if (confirm('Are you sure you want to delete this request?')) {
                    setRequests(requests.filter(req => req.id !== requestId));
                }
            };

            const downloadRequestPDF = (request) => {
                const totalDevices = request.totalDevices;
                
                const pdfContent = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 40px; color: #1a1a1a; }
                            .header { border-bottom: 3px solid #059669; padding-bottom: 20px; margin-bottom: 30px; }
                            .header h1 { color: #059669; margin: 0 0 10px 0; font-size: 28px; }
                            .header p { margin: 5px 0; color: #666; }
                            .status-badge { display: inline-block; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: bold; }
                            .status-open { background: #fef3c7; color: #92400e; }
                            .status-closed { background: #d1fae5; color: #065f46; }
                            .section { margin-bottom: 30px; }
                            .section-title { background: #059669; color: white; padding: 10px 15px; font-size: 16px; font-weight: bold; margin-bottom: 15px; }
                            .info-grid { display: grid; grid-template-columns: 150px 1fr; gap: 10px; margin-bottom: 15px; }
                            .info-label { font-weight: bold; color: #555; }
                            .info-value { color: #1a1a1a; }
                            table { width: 100%; border-collapse: collapse; margin-top: 15px; }
                            th { background: #f3f4f6; padding: 12px; text-align: left; border: 1px solid #ddd; font-size: 12px; color: #1a1a1a; }
                            td { padding: 10px; border: 1px solid #ddd; font-size: 11px; color: #1a1a1a; }
                            tr:nth-child(even) { background: #f9fafb; }
                            .summary-box { background: #ecfdf5; border-left: 4px solid #059669; padding: 15px; margin-top: 20px; }
                            .footer { margin-top: 40px; padding-top: 20px; border-top: 2px solid #e5e7eb; font-size: 12px; color: #666; }
                            .alert { background: #fef3c7; border-left: 4px solid #f59e0b; padding: 10px; margin: 15px 0; font-size: 12px; }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1>WEEE Collection Request</h1>
                            <p><strong>Request ID:</strong> ${request.id}</p>
                            <p><strong>Customer:</strong> Venterra</p>
                            <p><strong>Service Provider:</strong> Focus Group</p>
                            <p><strong>Request Date:</strong> ${new Date(request.date).toLocaleDateString('en-GB')}</p>
                            <p><strong>Status:</strong> <span class="status-badge status-${request.status}">${request.status.toUpperCase()}</span></p>
                            ${request.value ? `<p><strong>Estimated Value:</strong> £${request.value.toFixed(2)}</p>` : ''}
                        </div>

                        <div class="section">
                            <div class="section-title">Contact Information</div>
                            <div class="info-grid">
                                <div class="info-label">Requested By:</div>
                                <div class="info-value">${request.formData.requestedBy}</div>
                                <div class="info-label">Email:</div>
                                <div class="info-value">${request.formData.email}</div>
                                <div class="info-label">Phone:</div>
                                <div class="info-value">${request.formData.phone || 'Not specified'}</div>
                            </div>
                        </div>

                        <div class="section">
                            <div class="section-title">Collection Details</div>
                            <div class="info-grid">
                                <div class="info-label">Location:</div>
                                <div class="info-value">${request.location.name}</div>
                                <div class="info-label">Address:</div>
                                <div class="info-value">${request.location.address}</div>
                                <div class="info-label">Collection Date:</div>
                                <div class="info-value">${request.formData.collectionDate || 'ASAP'}</div>
                                <div class="info-label">On-Site Contact:</div>
                                <div class="info-value">${request.formData.onSiteContact || 'Not specified'}</div>
                                <div class="info-label">Contact Number:</div>
                                <div class="info-value">${request.formData.onSiteContactPhone || 'Not specified'}</div>
                            </div>
                            ${request.formData.specialInstructions ? `
                                <div style="margin-top: 15px;">
                                    <div class="info-label">Special Instructions:</div>
                                    <div class="info-value" style="margin-top: 5px;">${request.formData.specialInstructions}</div>
                                </div>
                            ` : ''}
                        </div>

                        <div class="alert">
                            <strong>Important:</strong> If Data Destruction is selected, no residual value will be supplied as saleable components will be destroyed.
                        </div>

                        <div class="section">
                            <div class="section-title">Equipment Details</div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Description</th>
                                        <th>Manufacturer</th>
                                        <th>Model</th>
                                        <th>CPU</th>
                                        <th>RAM</th>
                                        <th>Storage</th>
                                        <th>Qty</th>
                                        <th>Data Handling</th>
                                        <th>Accessories</th>
                                        <th>PSU</th>
                                        <th>Condition</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${request.devices.map(device => `
                                        <tr>
                                            <td>${device.description}</td>
                                            <td>${device.manufacturer || '-'}</td>
                                            <td>${device.model || '-'}</td>
                                            <td>${device.cpu || '-'}</td>
                                            <td>${device.ram || '-'}</td>
                                            <td>${device.storage || '-'}</td>
                                            <td>${device.quantity}</td>
                                            <td>${device.dataHandling}</td>
                                            <td>${device.accessories || 'None'}</td>
                                            <td>${device.powerSupply}</td>
                                            <td>${device.condition}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>

                        <div class="summary-box">
                            <strong>Collection Summary:</strong> ${totalDevices} device${totalDevices !== 1 ? 's' : ''} across ${request.devices.length} line item${request.devices.length !== 1 ? 's' : ''}
                        </div>

                        <div class="footer">
                            <p><strong>Focus Group</strong> - IT & Managed Services Provider</p>
                            <p>This document was generated from the Venterra WEEE Collection Portal</p>
                            <p>For queries regarding this collection, please contact the IT & Cyber Director</p>
                        </div>
                    </body>
                    </html>
                `;

                const printWindow = window.open('', '_blank');
                printWindow.document.write(pdfContent);
                printWindow.document.close();
                setTimeout(() => {
                    printWindow.print();
                }, 250);
            };

            const filteredRequests = requests
                .filter(req => {
                    if (filterStatus === 'all') return true;
                    return req.status === filterStatus;
                })
                .filter(req => {
                    if (!searchTerm) return true;
                    const search = searchTerm.toLowerCase();
                    return (
                        req.id.toLowerCase().includes(search) ||
                        req.formData.requestedBy.toLowerCase().includes(search) ||
                        req.formData.email.toLowerCase().includes(search) ||
                        req.location.name.toLowerCase().includes(search)
                    );
                });

            const selectedLocation = venterraLocations.find(loc => loc.id === formData.location);

            const stats = {
                total: requests.length,
                open: requests.filter(r => r.status === 'open').length,
                closed: requests.filter(r => r.status === 'closed').length,
                totalValue: requests.filter(r => r.value).reduce((sum, r) => sum + r.value, 0)
            };

            return (
                <div className="min-h-screen">
                    {/* Header */}
                    <div className="bg-white shadow-sm">
                        <div className="max-w-7xl mx-auto px-6 py-6">
                            <div className="flex items-center justify-between">
                                <div>
                                    <h1 className="text-3xl font-light text-gray-900 mb-1">venterra</h1>
                                    <p className="text-sm text-gray-600">WEEE Collection Portal</p>
                                </div>
                                <div className="flex gap-3">
                                    <button
                                        onClick={() => setView('form')}
                                        className={`px-6 py-2.5 rounded-lg font-medium transition-all ${
                                            view === 'form'
                                                ? 'bg-emerald-600 text-white shadow-lg'
                                                : 'bg-white text-gray-700 border-2 border-gray-200 hover:border-emerald-400'
                                        }`}
                                    >
                                        New Request
                                    </button>
                                    <button
                                        onClick={() => setView('reports')}
                                        className={`px-6 py-2.5 rounded-lg font-medium transition-all ${
                                            view === 'reports'
                                                ? 'bg-emerald-600 text-white shadow-lg'
                                                : 'bg-white text-gray-700 border-2 border-gray-200 hover:border-emerald-400'
                                        }`}
                                    >
                                        Reports ({requests.length})
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto p-6">
                        {view === 'form' ? (
                            <>
                                {/* Contact Information */}
                                <div className="bg-white rounded-xl shadow-lg p-8 mb-6">
                                    <h2 className="text-2xl font-light text-gray-900 mb-6 pb-3 border-b-2 border-emerald-500">Contact Information</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <label className="block text-sm font-semibold text-gray-800 mb-2">Requested By *</label>
                                            <input
                                                type="text"
                                                value={formData.requestedBy}
                                                onChange={(e) => updateFormData('requestedBy', e.target.value)}
                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-gray-900 font-medium"
                                                placeholder="Your name"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-semibold text-gray-800 mb-2">Email Address *</label>
                                            <input
                                                type="email"
                                                value={formData.email}
                                                onChange={(e) => updateFormData('email', e.target.value)}
                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-gray-900 font-medium"
                                                placeholder="your.email@venterra.com"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-semibold text-gray-800 mb-2">Contact Number</label>
                                            <input
                                                type="tel"
                                                value={formData.phone}
                                                onChange={(e) => updateFormData('phone', e.target.value)}
                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-gray-900 font-medium"
                                                placeholder="0161 123 4567"
                                            />
                                        </div>
                                    </div>
                                </div>

                                {/* Collection Details */}
                                <div className="bg-white rounded-xl shadow-lg p-8 mb-6">
                                    <h2 className="text-2xl font-light text-gray-900 mb-6 pb-3 border-b-2 border-emerald-500">Collection Details</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                        <div>
                                            <label className="block text-sm font-semibold text-gray-800 mb-2">Collection Location *</label>
                                            <select
                                                value={formData.location}
                                                onChange={(e) => updateFormData('location', e.target.value)}
                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-gray-900 font-medium"
                                            >
                                                <option value="">Select a location...</option>
                                                {venterraLocations.map(loc => (
                                                    <option key={loc.id} value={loc.id}>{loc.name}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-semibold text-gray-800 mb-2">Preferred Collection Date</label>
                                            <input
                                                type="date"
                                                value={formData.collectionDate}
                                                onChange={(e) => updateFormData('collectionDate', e.target.value)}
                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-gray-900 font-medium"
                                            />
                                        </div>
                                    </div>
                                    {selectedLocation && (
                                        <div className="bg-emerald-50 border-l-4 border-emerald-600 p-4 mb-6 rounded">
                                            <p className="text-sm font-semibold text-emerald-900">Collection Address:</p>
                                            <p className="text-sm text-gray-800">{selectedLocation.address}</p>
                                            {selectedLocation.contact && (
                                                <p className="text-sm text-gray-800 mt-2">
                                                    <span className="font-semibold">Office Contact:</span> {selectedLocation.contact}
                                                    {selectedLocation.email && ` (${selectedLocation.email})`}
                                                    {selectedLocation.phone && ` - ${selectedLocation.phone}`}
                                                </p>
                                            )}
                                        </div>
                                    )}
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                        <div>
                                            <label className="block text-sm font-semibold text-gray-800 mb-2">On-Site Contact Person *</label>
                                            <input
                                                type="text"
                                                value={formData.onSiteContact}
                                                onChange={(e) => updateFormData('onSiteContact', e.target.value)}
                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-gray-900 font-medium"
                                                placeholder="Contact name at collection location"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-semibold text-gray-800 mb-2">On-Site Contact Number *</label>
                                            <input
                                                type="tel"
                                                value={formData.onSiteContactPhone}
                                                onChange={(e) => updateFormData('onSiteContactPhone', e.target.value)}
                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-gray-900 font-medium"
                                                placeholder="Contact phone number"
                                            />
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold text-gray-800 mb-2">Special Instructions / Access Requirements</label>
                                        <textarea
                                            value={formData.specialInstructions}
                                            onChange={(e) => updateFormData('specialInstructions', e.target.value)}
                                            rows="3"
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-gray-900 font-medium"
                                            placeholder="e.g., Security requirements, loading bay access, contact on arrival..."
                                        />
                                    </div>
                                </div>

                                {/* Important Notice */}
                                <div className="bg-amber-50 border-l-4 border-amber-500 p-5 mb-6 rounded-lg shadow-sm">
                                    <p className="text-sm font-bold text-amber-900">Important Notice:</p>
                                    <p className="text-sm text-amber-800 font-medium">If Data Destruction is selected, no residual value will be supplied as we're destroying saleable components.</p>
                                </div>

                                {/* Equipment Details */}
                                <div className="bg-white rounded-xl shadow-lg p-8 mb-6">
                                    <div className="flex items-center justify-between mb-6 pb-3 border-b-2 border-emerald-500">
                                        <h2 className="text-2xl font-light text-gray-900">Equipment Details</h2>
                                        <button
                                            onClick={addDevice}
                                            className="flex items-center gap-2 px-5 py-2.5 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors shadow-md font-medium"
                                        >
                                            <Plus />
                                            Add Device
                                        </button>
                                    </div>

                                    <div className="space-y-3">
                                        {devices.map((device, index) => (
                                            <div key={device.id} className="border-2 border-gray-200 rounded-lg p-4 bg-gray-50 hover:border-emerald-300 transition-colors">
                                                <div className="flex items-center gap-3 mb-3">
                                                    <span className="flex items-center justify-center w-8 h-8 bg-emerald-600 text-white rounded-full font-bold text-sm">
                                                        {index + 1}
                                                    </span>
                                                    <input
                                                        type="text"
                                                        value={device.description}
                                                        onChange={(e) => updateDevice(device.id, 'description', e.target.value)}
                                                        className="flex-1 px-3 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 text-gray-900 font-semibold"
                                                        placeholder="Device Description *"
                                                    />
                                                    {devices.length > 1 && (
                                                        <button
                                                            onClick={() => removeDevice(device.id)}
                                                            className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                                                        >
                                                            <Trash2 />
                                                        </button>
                                                    )}
                                                </div>

                                                <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2">
                                                    <input
                                                        type="text"
                                                        value={device.manufacturer}
                                                        onChange={(e) => updateDevice(device.id, 'manufacturer', e.target.value)}
                                                        className="px-3 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 text-gray-900 text-sm font-medium"
                                                        placeholder="Manufacturer"
                                                    />
                                                    <input
                                                        type="text"
                                                        value={device.model}
                                                        onChange={(e) => updateDevice(device.id, 'model', e.target.value)}
                                                        className="px-3 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 text-gray-900 text-sm font-medium"
                                                        placeholder="Model/Part #"
                                                    />
                                                    <input
                                                        type="text"
                                                        value={device.cpu}
                                                        onChange={(e) => updateDevice(device.id, 'cpu', e.target.value)}
                                                        className="px-3 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 text-gray-900 text-sm font-medium"
                                                        placeholder="CPU"
                                                    />
                                                    <input
                                                        type="text"
                                                        value={device.ram}
                                                        onChange={(e) => updateDevice(device.id, 'ram', e.target.value)}
                                                        className="px-3 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 text-gray-900 text-sm font-medium"
                                                        placeholder="RAM"
                                                    />
                                                    <input
                                                        type="text"
                                                        value={device.storage}
                                                        onChange={(e) => updateDevice(device.id, 'storage', e.target.value)}
                                                        className="px-3 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 text-gray-900 text-sm font-medium"
                                                        placeholder="Storage"
                                                    />
                                                    <input
                                                        type="number"
                                                        min="1"
                                                        value={device.quantity}
                                                        onChange={(e) => updateDevice(device.id, 'quantity', e.target.value)}
                                                        className="px-3 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 text-gray-900 text-sm font-medium"
                                                        placeholder="Qty *"
                                                    />
                                                    <select
                                                        value={device.dataHandling}
                                                        onChange={(e) => updateDevice(device.id, 'dataHandling', e.target.value)}
                                                        className="px-3 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 text-gray-900 text-sm font-medium"
                                                    >
                                                        {dataHandlingOptions.map(opt => (
                                                            <option key={opt} value={opt}>{opt}</option>
                                                        ))}
                                                    </select>
                                                    <select
                                                        value={device.condition}
                                                        onChange={(e) => updateDevice(device.id, 'condition', e.target.value)}
                                                        className="px-3 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 text-gray-900 text-sm font-medium"
                                                    >
                                                        {conditionOptions.map(opt => (
                                                            <option key={opt} value={opt}>{opt}</option>
                                                        ))}
                                                    </select>
                                                    <input
                                                        type="text"
                                                        value={device.accessories}
                                                        onChange={(e) => updateDevice(device.id, 'accessories', e.target.value)}
                                                        className="px-3 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 text-gray-900 text-sm font-medium"
                                                        placeholder="Accessories"
                                                    />
                                                    <select
                                                        value={device.powerSupply}
                                                        onChange={(e) => updateDevice(device.id, 'powerSupply', e.target.value)}
                                                        className="px-3 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 text-gray-900 text-sm font-medium"
                                                    >
                                                        <option value="Yes">PSU: Yes</option>
                                                        <option value="No">PSU: No</option>
                                                        <option value="N/A">PSU: N/A</option>
                                                    </select>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Generate Report Button */}
                                <div className="bg-white rounded-xl shadow-lg p-8">
                                    <button
                                        type="button"
                                        onClick={generateReport}
                                        className="w-full flex items-center justify-center gap-3 px-8 py-5 bg-gradient-to-r from-emerald-600 to-emerald-700 text-white font-bold rounded-xl hover:from-emerald-700 hover:to-emerald-800 transition-all shadow-lg text-lg cursor-pointer"
                                    >
                                        <Send />
                                        Generate Report & Send Email
                                    </button>
                                    <p className="text-center text-sm text-gray-700 mt-4 font-medium">
                                        This will create a new collection request and send a confirmation email to the requester
                                    </p>
                                </div>
                            </>
                        ) : (
                            <>
                                {/* Statistics Dashboard */}
                                <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                                    <div className="bg-white rounded-xl shadow-lg p-6">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-sm text-gray-600 mb-1 font-semibold">Total Requests</p>
                                                <p className="text-4xl font-bold text-gray-900">{stats.total}</p>
                                            </div>
                                            <FileText />
                                        </div>
                                    </div>
                                    <div className="bg-white rounded-xl shadow-lg p-6">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-sm text-gray-600 mb-1 font-semibold">Open Requests</p>
                                                <p className="text-4xl font-bold text-amber-600">{stats.open}</p>
                                            </div>
                                            <Clock />
                                        </div>
                                    </div>
                                    <div className="bg-white rounded-xl shadow-lg p-6">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-sm text-gray-600 mb-1 font-semibold">Completed</p>
                                                <p className="text-4xl font-bold text-green-600">{stats.closed}</p>
                                            </div>
                                            <CheckCircle />
                                        </div>
                                    </div>
                                    <div className="bg-white rounded-xl shadow-lg p-6">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-sm text-gray-600 mb-1 font-semibold">Total Value</p>
                                                <p className="text-4xl font-bold text-blue-600">£{stats.totalValue.toFixed(0)}</p>
                                            </div>
                                            <DollarSign />
                                        </div>
                                    </div>
                                </div>

                                {/* Filters and Search */}
                                <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                                    <div className="flex flex-col md:flex-row gap-4">
                                        <div className="flex-1">
                                            <div className="relative">
                                                <div className="absolute left-4 top-1/2 transform -translate-y-1/2">
                                                    <Search />
                                                </div>
                                                <input
                                                    type="text"
                                                    placeholder="Search by request ID, name, email, or location..."
                                                    value={searchTerm}
                                                    onChange={(e) => setSearchTerm(e.target.value)}
                                                    className="w-full pl-12 pr-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-gray-900 font-medium"
                                                />
                                            </div>
                                        </div>
                                        <div className="flex gap-3">
                                            <button
                                                onClick={() => setFilterStatus('all')}
                                                className={`px-5 py-3 rounded-lg font-semibold transition-all ${
                                                    filterStatus === 'all'
                                                        ? 'bg-emerald-600 text-white shadow-lg'
                                                        : 'bg-white text-gray-700 border-2 border-gray-200 hover:border-emerald-400'
                                                }`}
                                            >
                                                All ({stats.total})
                                            </button>
                                            <button
                                                onClick={() => setFilterStatus('open')}
                                                className={`px-5 py-3 rounded-lg font-semibold transition-all ${
                                                    filterStatus === 'open'
                                                        ? 'bg-amber-600 text-white shadow-lg'
                                                        : 'bg-white text-gray-700 border-2 border-gray-200 hover:border-amber-400'
                                                }`}
                                            >
                                                Open ({stats.open})
                                            </button>
                                            <button
                                                onClick={() => setFilterStatus('closed')}
                                                className={`px-5 py-3 rounded-lg font-semibold transition-all ${
                                                    filterStatus === 'closed'
                                                        ? 'bg-green-600 text-white shadow-lg'
                                                        : 'bg-white text-gray-700 border-2 border-gray-200 hover:border-green-400'
                                                }`}
                                            >
                                                Closed ({stats.closed})
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                {/* Requests List */}
                                <div className="space-y-4">
                                    {filteredRequests.length === 0 ? (
                                        <div className="bg-white rounded-xl shadow-lg p-16 text-center">
                                            <div className="mx-auto mb-4"><FileText /></div>
                                            <h3 className="text-2xl font-light text-gray-700 mb-2">No Requests Found</h3>
                                            <p className="text-gray-600 font-medium">
                                                {searchTerm || filterStatus !== 'all'
                                                    ? 'Try adjusting your filters or search term'
                                                    : 'Create your first WEEE collection request to get started'}
                                            </p>
                                        </div>
                                    ) : (
                                        filteredRequests.map(request => (
                                            <div key={request.id} className="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow">
                                                <div className="flex items-start justify-between mb-4">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-3 mb-3">
                                                            <h3 className="text-xl font-semibold text-gray-900">{request.id}</h3>
                                                            <span className={`px-4 py-1.5 rounded-full text-xs font-bold ${
                                                                request.status === 'open'
                                                                    ? 'bg-amber-100 text-amber-800'
                                                                    : 'bg-green-100 text-green-800'
                                                            }`}>
                                                                {request.status === 'open' ? '⏱ OPEN' : '✓ CLOSED'}
                                                            </span>
                                                        </div>
                                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm">
                                                            <div>
                                                                <span className="text-gray-600 font-semibold">Requested by:</span>
                                                                <p className="font-bold text-gray-900">{request.formData.requestedBy}</p>
                                                            </div>
                                                            <div>
                                                                <span className="text-gray-600 font-semibold">Location:</span>
                                                                <p className="font-bold text-gray-900">{request.location.name}</p>
                                                            </div>
                                                            <div>
                                                                <span className="text-gray-600 font-semibold">Devices:</span>
                                                                <p className="font-bold text-gray-900">{request.totalDevices} units</p>
                                                            </div>
                                                            <div>
                                                                <span className="text-gray-600 font-semibold">Date:</span>
                                                                <p className="font-bold text-gray-900">
                                                                    {new Date(request.date).toLocaleDateString('en-GB')}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div className="flex flex-wrap items-center gap-3 pt-4 border-t-2 border-gray-100">
                                                    <div className="flex items-center gap-2">
                                                        <DollarSign />
                                                        {editingValue === request.id ? (
                                                            <div className="flex items-center gap-2">
                                                                <input
                                                                    type="number"
                                                                    step="0.01"
                                                                    placeholder="Enter value"
                                                                    defaultValue={request.value || ''}
                                                                    onKeyDown={(e) => {
                                                                        if (e.key === 'Enter') {
                                                                            updateValue(request.id, e.target.value);
                                                                        }
                                                                    }}
                                                                    className="w-32 px-3 py-2 border-2 border-gray-300 rounded-lg text-sm font-semibold text-gray-900"
                                                                    autoFocus
                                                                />
                                                                <button
                                                                    onClick={() => setEditingValue(null)}
                                                                    className="text-gray-600 hover:text-gray-800"
                                                                >
                                                                    <X />
                                                                </button>
                                                            </div>
                                                        ) : (
                                                            <button
                                                                onClick={() => setEditingValue(request.id)}
                                                                className="text-sm font-bold text-emerald-600 hover:text-emerald-800"
                                                            >
                                                                {request.value ? `£${request.value.toFixed(2)}` : 'Add Value'}
                                                            </button>
                                                        )}
                                                    </div>

                                                    <div className="flex-1"></div>

                                                    <button
                                                        onClick={() => downloadRequestPDF(request)}
                                                        className="flex items-center gap-2 px-5 py-2.5 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors text-sm font-semibold shadow-md"
                                                    >
                                                        <FileText />
                                                        View PDF
                                                    </button>

                                                    {request.status === 'open' ? (
                                                        <button
                                                            onClick={() => markAsCompleted(request.id)}
                                                            className="flex items-center gap-2 px-5 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-semibold shadow-md"
                                                        >
                                                            <CheckCircle />
                                                            Mark Complete
                                                        </button>
                                                    ) : (
                                                        <button
                                                            onClick={() => reopenRequest(request.id)}
                                                            className="flex items-center gap-2 px-5 py-2.5 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors text-sm font-semibold shadow-md"
                                                        >
                                                            <Clock />
                                                            Reopen
                                                        </button>
                                                    )}

                                                    <button
                                                        onClick={() => deleteRequest(request.id)}
                                                        className="flex items-center gap-2 px-5 py-2.5 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-semibold shadow-md"
                                                    >
                                                        <Trash2 />
                                                        Delete
                                                    </button>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<VenterraWEEEForm />, document.getElementById('app'));
    </script>
</body>
</html>